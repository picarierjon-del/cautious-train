<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Gestionale Pizzeria ‚Äì App Web</title>
<meta name="theme-color" content="#0b1223">
<style>
:root{
  --bg:#0b1223; --panel:#0f172a; --ring:rgba(255,255,255,.08);
  --ink:#e5e7eb; --ink-dim:#9aa4bf;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;background:var(--bg);color:var(--ink);display:flex;flex-direction:column}
header,footer{position:fixed;left:0;right:0;z-index:20;display:flex;align-items:center;gap:8px;background:rgba(12,20,38,.9);backdrop-filter:blur(10px)}
header{top:0;padding:calc(env(safe-area-inset-top)+8px) 10px 8px;border-bottom:1px solid var(--ring)}
footer{bottom:0;padding:8px 10px calc(env(safe-area-inset-bottom)+8px);border-top:1px solid var(--ring)}
main{flex:1;display:grid;grid-template-columns:300px 1fr;min-height:0;margin-top:calc(env(safe-area-inset-top)+60px);margin-bottom:calc(env(safe-area-inset-bottom)+60px)}
@media(max-width:900px){main{grid-template-columns:1fr}}
aside{background:var(--panel);border-right:1px solid var(--ring);padding:10px;overflow:auto}
.ticket-item{border-bottom:1px dashed var(--ring);padding:8px 4px;cursor:pointer}
.ticket-item.active{outline:2px solid #3b82f6;border-radius:8px}
.extra{font-size:.9rem;color:var(--ink-dim);display:flex;justify-content:space-between;align-items:center}
.total{padding-top:8px;margin-top:8px;border-top:1px solid var(--ring);font-weight:700}
.stage{display:flex;flex-direction:column;min-width:0}
.tabs{display:flex;gap:8px;padding:10px;border-bottom:1px solid var(--ring);background:var(--panel);overflow-x:auto}
.tab{border:1px solid var(--ring);border-radius:10px;padding:6px 10px;cursor:pointer;white-space:nowrap;background:#0e1427}
.tab.active{outline:2px solid rgba(255,255,255,.18)}
.searchbox{padding:6px 12px;background:var(--panel);border-bottom:1px solid var(--ring)}
.searchbox input{width:90%;padding:6px;border-radius:8px;border:1px solid var(--ring);background:#0b1223;color:var(--ink)}
.grid{flex:1;overflow:auto;padding:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px}
.gridbtn{border:none;border-radius:12px;padding:16px 10px;color:#fff;font-weight:700;cursor:pointer;text-shadow:0 1px 1px rgba(0,0,0,.3)}
.gridbtn small{display:block;opacity:.9;font-weight:600}
.quick{border:1px solid var(--ring);border-radius:10px;padding:10px 12px;background:linear-gradient(180deg,#1f2937,#0b1223);color:#fff;font-weight:600;cursor:pointer}
.btn{cursor:pointer;border:1px solid var(--ring);padding:8px 12px;border-radius:10px;background:linear-gradient(180deg,#1f2937,#0b1223);color:var(--ink);font-weight:600}
.btn.icon{padding:8px;width:42px;justify-content:center}
.c-red{background:#ef4444}.c-orange{background:#f97316}.c-yellow{background:#eab308}
.c-green{background:#22c55e}.c-blue{background:#3b82f6}.c-purple{background:#8b5cf6}
.c-pink{background:#ec4899}.c-gray{background:#6b7280}
</style>
</head>
<body>
<header>
  <div style="font-weight:700">üßæ Gestionale</div>
  <div class="grow"></div>
  <button class="btn" id="btnPrint">üñ®Ô∏è</button>
  <button class="btn" id="btnWA">üü¢</button>
  <button class="btn" id="btnMail">‚úâÔ∏è</button>
  <button class="btn" id="btnCopy">üìã</button>
</header>

<main>
  <aside>
    <div style="display:flex;justify-content:space-between;margin-bottom:6px">
      <strong>Ordine</strong><span id="now"></span>
    </div>
    <div id="ticket"></div>
    <div class="total">Totale: <span id="grandTotal">‚Ç¨ 0,00</span></div>
  </aside>
  <section class="stage">
    <div class="tabs" id="tabs"></div>
    <div class="searchbox">üîç <input id="searchBox" type="text" placeholder="Cerca..."></div>
    <div class="grid" id="grid"></div>
  </section>
</main>

<footer>
  <div id="bottomMenus" style="display:flex;flex-wrap:wrap;gap:6px;overflow-x:auto"></div>
</footer>

<script>
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
const money=n=>(isNaN(n)?0:n).toLocaleString('it-IT',{style:'currency',currency:'EUR'});
const nowFmt=()=>new Date().toLocaleString('it-IT',{timeStyle:'short'});

// === Tutti i gruppi e articoli ===
const configTop=[
  {label:"Pizze",color:"c-red",items:[
    {label:"Margherita",price:6,color:"c-red"},
    {label:"Diavola",price:7,color:"c-red"},
    {label:"Capricciosa",price:7.5,color:"c-red"},
    {label:"Quattro Stagioni",price:7.5,color:"c-red"},
    {label:"Bufala",price:8,color:"c-pink"}
  ]},
  {label:"Calzoni",color:"c-orange",items:[
    {label:"Classico",price:7,color:"c-orange"},
    {label:"Ripieno",price:8,color:"c-orange"}
  ]},
  {label:"Panini",color:"c-yellow",items:[
    {label:"Hamburger",price:5.5,color:"c-yellow"},
    {label:"Hot Dog",price:4.5,color:"c-yellow"}
  ]},
  {label:"Schiacciata grande",color:"c-green",items:[
    {label:"Semplice",price:9,color:"c-green"}
  ]},
  {label:"Mezzo metro",color:"c-blue",items:[
    {label:"Salumi",price:14,color:"c-blue"}
  ]},
  {label:"Bibite",color:"c-purple",items:[
    {label:"Cola",price:2,color:"c-purple"},
    {label:"Acqua",price:1,color:"c-purple"},
    {label:"Birra",price:3,color:"c-purple"}
  ]},
  {label:"Ordini",color:"c-gray",items:[]}
];

const configBottom=[
  {label:"Pi√π",color:"c-green",items:[
    {label:"Mozzarella",price:1,color:"c-green"},
    {label:"Funghi",price:1,color:"c-green"},
    {label:"Prosciutto",price:1.5,color:"c-green"}
  ]},
  {label:"Senza",color:"c-gray",items:[
    {label:"Pomodoro",price:0,color:"c-gray"},
    {label:"Cipolla",price:0,color:"c-gray"}
  ]},
  {label:"Poco",color:"c-yellow",items:[
    {label:"Olio",price:0,color:"c-yellow"}
  ]},
  {label:"Abbondante",color:"c-purple",items:[
    {label:"Formaggio",price:1,color:"c-purple"},
    {label:"Olive",price:0.5,color:"c-purple"}
  ]},
  {label:"Consegna a domicilio",color:"c-blue",items:[
    {label:"Consegna",price:1.5,color:"c-blue"}
  ]},
  {label:"Da asporto",color:"c-orange",items:[]},
  {label:"Banco",color:"c-gray",items:[]}
];

let items=[],activeIndex=-1,currentTop=0,currentBottomGroup=null;

function buildTabs(){
  const tabs=$('#tabs');tabs.innerHTML='';
  configTop.forEach((g,i)=>{
    const b=document.createElement('button');
    b.className='tab'+(i===currentTop && !currentBottomGroup?' active':'');
    b.textContent=g.label;
    b.onclick=()=>{currentTop=i;currentBottomGroup=null;buildGrid();};
    tabs.appendChild(b);
  });
}
function buildBottomMenus(){
  const box=$('#bottomMenus');box.innerHTML='';
  configBottom.forEach(g=>{
    const b=document.createElement('button');
    b.className='quick '+g.color;
    b.textContent=g.label;
    b.onclick=()=>{currentBottomGroup=g;buildGrid();};
    box.appendChild(b);
  });
}
function buildGrid(){
  const grid=$('#grid');grid.innerHTML='';
  const list=currentBottomGroup?currentBottomGroup.items:configTop[currentTop].items;
  (list||[]).forEach(it=>{
    const btn=document.createElement('button');
    btn.className='gridbtn '+(it.color||'c-gray');
    btn.innerHTML=`${it.label}<small>${money(it.price)}</small>`;
    btn.onclick=()=>{
      if(currentBottomGroup){ addExtra(it); }
      else { addItem(it); }
    };
    grid.appendChild(btn);
  });
  filterGrid();
}
function addItem(it){
  items.push({name:it.label,price:it.price,qty:1,extras:[]});
  activeIndex=items.length-1;render();
}
function addExtra(it){
  if(items.length===0) return alert('Aggiungi prima un articolo');
  const idx=activeIndex>=0?activeIndex:items.length-1;
  items[idx].extras.push({text:it.label,price:it.price});
  render();
}
function render(){
  const t=$('#ticket');t.innerHTML='';let tot=0;
  items.forEach((it,i)=>{
    const exSum=it.extras.reduce((s,e)=>s+e.price,0);
    const sub=(it.price+exSum)*it.qty; tot+=sub;
    const div=document.createElement('div');
    div.className='ticket-item'+(i===activeIndex?' active':'');
    div.innerHTML=`<div><strong contenteditable data-i="${i}" data-f="name">${it.name}</strong></div>
      <div>‚Ç¨ <span contenteditable data-i="${i}" data-f="price">${it.price}</span> √ó
      <span contenteditable data-i="${i}" data-f="qty">${it.qty}</span>
      <button data-del="${i}">üóëÔ∏è</button></div>
      ${it.extras.map((e,ei)=>`<div class="extra">‚Ä¢ ${e.text} +${money(e.price)} <button data-rm="${i}-${ei}">‚úñ</button></div>`).join('')}
      <div class="extra"><span>Sub</span><strong>${money(sub)}</strong></div>`;
    t.appendChild(div);
  });
  $('#grandTotal').textContent=money(tot);
}
$('#ticket').addEventListener('input',e=>{
  const i=+e.target.dataset.i,f=e.target.dataset.f;
  if(f==='name') items[i].name=e.target.textContent;
  if(f==='price') items[i].price=parseFloat(e.target.textContent)||0;
  if(f==='qty') items[i].qty=parseInt(e.target.textContent)||1;
  render();
});
$('#ticket').addEventListener('click',e=>{
  const t=e.target;
  if(t.dataset.del){items.splice(+t.dataset.del,1);render();}
  if(t.dataset.rm){const [i,ei]=t.dataset.rm.split('-').map(Number);items[i].extras.splice(ei,1);render();}
});

// ricerca
$('#searchBox').addEventListener('input',filterGrid);
function filterGrid(){
  const q=$('#searchBox').value.toLowerCase();
  $('#grid').querySelectorAll('button').forEach(b=>{
    b.style.display=b.textContent.toLowerCase().includes(q)?'':'none';
  });
}

// condivisione / stampa
$('#btnPrint').onclick=()=>window.print();
$('#btnCopy').onclick=async()=>{await navigator.clipboard.writeText(orderText());alert('Copiato!');};
$('#btnWA').onclick=()=>window.open('https://wa.me/?text='+encodeURIComponent(orderText()),'_blank');
$('#btnMail').onclick=()=>location.href='mailto:?subject=Ordine&body='+encodeURIComponent(orderText());
function orderText(){return items.map(it=>`${it.qty}√ó ${it.name} ‚Ç¨${it.price}${it.extras.map(e=>`\n  +${e.text} ${money(e.price)}`).join('')}`).join('\n')+'\nTotale: '+$('#grandTotal').textContent;}
setInterval(()=>$('#now').textContent=nowFmt(),60000);

buildTabs();buildBottomMenus();buildGrid();render();
</script>
</body>
</html>
